<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Lost & Found Management System</title>
    <link rel="stylesheet" href="assets/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <h1>Lost & Found</h1>
                </div>
                <div class="hamburger" id="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="nav-menu" id="nav-user">
                    <!-- Navigation will be populated by JavaScript -->
                </div>
            </div>
        </nav>
    </header>

    <main id="main-content" class="container page-transition">
        <div class="dashboard-header">
            <h2>Lost & Found Dashboard</h2>
            <div class="filter-tabs">
                <button class="tab-btn active" data-filter="all">All Items</button>
                <button class="tab-btn" data-filter="lost">Lost Items</button>
                <button class="tab-btn" data-filter="found">Found Items</button>
            </div>
        </div>

        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search by item name, category, or location...">
            <button id="searchBtn" class="btn btn-primary">Search</button>
        </div>

        <div class="items-grid" id="itemsGrid">
            <!-- Items will be populated by JavaScript -->
        </div>

        <div class="no-results" id="noResults" style="display: none;">
            <p>No items found matching your criteria.</p>
        </div>
    </main>

    <div id="claimModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="modal-header">
                <h2>Claim This Item</h2>
            </div>
            <div class="modal-body">
                <form id="claimForm">
                    <input type="hidden" id="claimFoundId" name="FoundID">
                    <div class="form-group">
                        <label for="claimProof">Proof of Ownership</label>
                        <textarea id="claimProof" name="proof" rows="4" required placeholder="Describe how you can prove this item belongs to you..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelClaim">Cancel</button>
                <button type="submit" form="claimForm" class="btn btn-primary">Submit Claim</button>
            </div>
            <div id="claimMessage" class="form-message"></div>
        </div>
    </div>

    <script src="assets/app.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check if user is already logged in
        const user = getCurrentUser();
        if (user) {
            const afterLogin = localStorage.getItem('afterLogin');
            localStorage.removeItem('afterLogin');
            window.location.href = afterLogin || 'dashboard.html';
        }

        // Initialize navigation
        populateNav();

        // Tab switching
        const tabBtns = document.querySelectorAll('.tab-btn');
        tabBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const tabId = btn.getAttribute('data-tab');
                
                tabBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        /* ------------------------------
           LOGIN SUBMISSION (FIXED)
        ------------------------------ */
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // FIXED: removed "api/"
            const response = await apiFetch('login.php', 'POST', { email, password });
            
            if (response.ok && response.success) {
                localStorage.setItem('user', JSON.stringify(response.user));
                showMessage('#loginMessage', 'Login successful! Redirecting...', 'success');
                
                const afterLogin = localStorage.getItem('afterLogin');
                localStorage.removeItem('afterLogin');
                
                setTimeout(() => {
                    window.location.href = afterLogin || 'dashboard.html';
                }, 1500);
            } else {
                showMessage('#loginMessage', response.error || 'Login failed', 'error');
            }
        });

        /* ------------------------------
           REGISTER SUBMISSION (FIXED)
        ------------------------------ */
        document.getElementById('registerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const phone = document.getElementById('registerPhone').value;
            const password = document.getElementById('registerPassword').value;
            const role = document.getElementById('registerRole').value; // Always "Student"
            
            // FIXED: removed "api/"
            const response = await apiFetch('register.php', 'POST', { 
                name, email, phone, password, role 
            });
            
            if (response.ok && response.success) {
                showMessage('#registerMessage', 'Registration successful! Please login.', 'success');
                document.querySelector('[data-tab="login"]').click();
                document.getElementById('registerForm').reset();
            } else {
                showMessage('#registerMessage', response.error || 'Registration failed', 'error');
            }
        });
    });
</script>

</body>
</html>